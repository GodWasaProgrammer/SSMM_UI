<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vlc="clr-namespace:LibVLCSharp.Avalonia;assembly=LibVLCSharp.Avalonia"
        xmlns:local="clr-namespace:SSMM_UI"
        x:Class="SSMM_UI.MainWindow"
		x:Name="Root"
		xmlns:ia="using:Avalonia.Xaml.Interactivity"
		xmlns:ic="using:Avalonia.Xaml.Interactions.Core"
        x:DataType="local:MainWindowViewModel"
        Title="SSMM_UI" Width="1920" Height="1080"
        Background="{DynamicResource BackgroundColor}">
	
	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="250"/>
			<ColumnDefinition Width="*"/>
		</Grid.ColumnDefinitions>

		<!-- Left Sidebar -->
		<Border Grid.Column="0" Background="{DynamicResource CardColor}" BorderBrush="{DynamicResource BorderColor}" BorderThickness="0 0 1 0">
			<ScrollViewer>
				<StackPanel Margin="15">

					<!-- Video Preview -->
					<Border Classes="card">
						<local:MyVideoView x:Name="RtmpIncoming" Width="220" Height="124" IsVisible="{Binding IsReceivingStream}"/>
					</Border>

					<!-- Services Section -->
					<Border Classes="card">
						<StackPanel>
							<TextBlock Text="STREAM SERVICES" Classes="secondary" Margin="0 0 0 5"/>
							<ListBox ItemsSource="{Binding RtmpServiceGroups}"
									 SelectedItem="{Binding SelectedRtmpService, Mode=TwoWay}"
									 Height="250" Width="220"
									 Background="Transparent"
									 BorderBrush="{DynamicResource BorderColor}">
								<ListBox.ItemTemplate>
									<DataTemplate x:DataType="local:RtmpServiceGroup">
										<Button Command="{Binding DataContext.AddServiceCommand, ElementName=Root}"
												CommandParameter="{Binding}"
												Classes="listItemButton">
											<TextBlock Text="{Binding ServiceName}" Padding="5 3" FontSize="14"/>
										</Button>
									</DataTemplate>
								</ListBox.ItemTemplate>
							</ListBox>
						</StackPanel>
					</Border>
					<!-- Login Section -->
					<Border Classes="card">
						<StackPanel>
							<TextBlock Text="Logins" HorizontalAlignment="Center" Classes="secondary" Margin="0 0 0 5"/>
							<Button Content="Youtube" Classes="primary" HorizontalAlignment="Center"
                                    Command="{Binding LoginWithGoogleCommand}"/>
							<TextBlock Text="{Binding YoutubeLoginStatus}" Classes="secondary" Margin="0 10 0 0"/>
							<Button Content="Kick" Classes="primary" HorizontalAlignment="Center"
                                    Command="{Binding LoginWithKickCommand}"/>
							<TextBlock Text="{Binding KickLoginStatus}" Classes="secondary" Margin="0 10 0 0"/>
							<Button Content="Twitch" Classes="primary" HorizontalAlignment="Center"
                                    Command="{Binding LoginWithTwitchCommand}"/>
							<TextBlock Text="{Binding TwitchLoginStatus}" Classes="secondary" Margin="0 10 0 0"/>
						</StackPanel>
					</Border>

					<!-- Selected Services Section -->
					<Border Classes="card">
						<StackPanel>
							<TextBlock Text="SELECTED SERVICES" Classes="secondary" Margin="0 0 0 5"/>
							<Border BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" CornerRadius="4" Margin="0 0 0 5" Padding="1">
								<ListBox SelectedItem="{Binding SelectedService, Mode=TwoWay}" ItemsSource="{Binding SelectedServicesToStream}" Height="250" Background="Transparent" BorderThickness="0" Padding="5">
									<ListBox.ItemTemplate>
										<DataTemplate>
											<StackPanel Margin="0 5">
												
													<TextBlock Text="{Binding DisplayName}" />
												
											</StackPanel>
										</DataTemplate>
									</ListBox.ItemTemplate>
								</ListBox>
							</Border>
						</StackPanel>
					</Border>

					<Button Content="Remove Selected" Width="180" HorizontalAlignment="Center" Classes="danger" Margin="0 5 0 0"
                            Command="{Binding RemoveSelectedServiceCommand}"/>
				</StackPanel>
			</ScrollViewer>
		</Border>

		<!-- Main Content Area -->
		<TabControl Grid.Column="1" Background="Transparent" BorderThickness="0">
			<TabItem Header="Stream">
				<ScrollViewer>
					<StackPanel Margin="15">
						<Border Classes="card">
							<StackPanel>
								<TextBlock Text="STREAM CONTROLS" Classes="secondary"/>
								<WrapPanel>
									<Button Content="Start Stream" Classes="success" Margin="0 0 15 0"
                                            Command="{Binding StartStreamCommand}" IsEnabled="{Binding CanStartStream}"/>
									<Button Content="Stop Streams" Classes="danger" Margin="0 0 15 0"
                                            Command="{Binding StopStreamsCommand}" IsEnabled="{Binding CanStopStream}"/>
									<Button Content="Start Receiving" Classes="danger" Margin="0 0 15 0"
                                            Command="{Binding ToggleReceivingStreamCommand}"/>
								</WrapPanel>

								<StackPanel Margin="0 10 0 0">
									<TextBlock Text="{Binding StreamStatusText}" Classes="secondary"/>
									<TextBlock Text="{Binding ServerStatusText}" FontWeight="SemiBold"/>
								</StackPanel>
							</StackPanel>
						</Border>

						<Border Classes="card">
							<StackPanel>
								<TextBlock Text="LOGS" Classes="secondary"/>
								<ListBox ItemsSource="{Binding LogMessages}" Height="400"
										 SelectedItem="{Binding SelectedLogItem}"
                                         FontFamily="Consolas, Courier New" BorderThickness="0"
                                         Background="{DynamicResource BorderColor}" Opacity="0.2"
                                         Foreground="{DynamicResource PrimaryTextColor}" Padding="10"/>
							</StackPanel>
						</Border>
					</StackPanel>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Stream Metadata">
				<ScrollViewer>
					<StackPanel Margin="15" Width="600">
						<Border Classes="card">
							<StackPanel>
								<TextBlock Text="STREAM METADATA" Classes="secondary"/>

								<TextBlock Text="Title" FontWeight="SemiBold"/>
								<TextBox Text="{Binding TitleText}" FontSize="14" Padding="10"
                                         BorderBrush="{DynamicResource BorderColor}" BorderThickness="1"
                                         CornerRadius="4" Background="{DynamicResource CardColor}" Foreground="{DynamicResource PrimaryTextColor}"/>

								<StackPanel>
									<TextBlock FontWeight="SemiBold">Category (Youtube)</TextBlock>
									<ComboBox x:Name="YoutubeCategoriesCombo"
											  ItemsSource="{Binding YoutubeVideoCategories}"
											  Width="250"
											  Background="Transparent"
											  BorderThickness="0"
											  Padding="5">
										<ComboBox.Styles>
											<Style Selector="ComboBoxItem">
												<Setter Property="Margin" Value="0 0 5 0"/>
												<Setter Property="Padding" Value="5 3"/>
											</Style>
											<Style Selector="ComboBoxItem:selected">
												<Setter Property="Background">
													<Setter.Value>
														<SolidColorBrush Color="{DynamicResource BorderColor}" Opacity="0.3"/>
													</Setter.Value>
												</Setter>
											</Style>
										</ComboBox.Styles>
										<ComboBox.ItemTemplate>
											<DataTemplate>
												<StackPanel Margin="0 5">
													<TextBlock Text="{Binding Path=Snippet.Title}" FontWeight="SemiBold" FontSize="14"/>
												</StackPanel>
											</DataTemplate>
										</ComboBox.ItemTemplate>
									</ComboBox>
								</StackPanel>

								<TextBlock Text="Thumbnail" FontWeight="SemiBold" Margin="0 10 0 0"/>
								<Border Width="300" Height="168" BorderBrush="{DynamicResource BorderColor}" BorderThickness="1"
                                        CornerRadius="4" Background="{DynamicResource BorderColor}" Opacity="0.1">
									<Image Source="{Binding ThumbnailImage}" Stretch="Uniform" Margin="5"/>
								</Border>
								<Button Content="Upload Thumbnail" Classes="primary" Margin="0 10 0 0" Command="{Binding UploadThumbnailCommand}"/>

								<Button Content="Update Metadata" Classes="primary" Margin="0 10 0 0" Command="{Binding UpdateMetadataCommand}"/>

								<TextBlock Text="{Binding MetadataStatus}" Foreground="{DynamicResource DangerColor}" Margin="0 10 0 0" TextWrapping="Wrap"/>
							</StackPanel>
						</Border>
					</StackPanel>
				</ScrollViewer>
			</TabItem>

			<TabItem Header="Social Media AutoPoster">
				<ScrollViewer>
					<StackPanel Margin="15" Width="600">
						<Border Classes="card">
							<StackPanel>
								<CheckBox Content="X(Twitter)" IsChecked="{Binding PostToX}"/>
								<CheckBox Content="Facebook" IsChecked="{Binding PostToFacebook}"/>
								<CheckBox Content="Discord" IsChecked="{Binding PostToDiscord}"/>
							</StackPanel>
						</Border>
					</StackPanel>
				</ScrollViewer>
			</TabItem>
		</TabControl>
	</Grid>
</Window>

<!--<TabItem Header="#DEBUG">
				<StackPanel>
					<Button Click="ClearGoogleOAuthTokens">Clear Tokens</Button>
				</StackPanel>
			</TabItem>-->


